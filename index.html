<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Melly's Schedule</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  /* PROFILE CARD */
.profile-card{
  margin-top:16px;
  display:flex;
  gap:16px;
  padding:16px;
  background:rgba(255,255,255,0.55);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.6);
  backdrop-filter:blur(10px);
}
.profile-card img{
  width:100px;
  height:100px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid var(--accent-2);
}
.profile-info{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.profile-name{
  font-weight:700;
  font-size:20px;
}
.profile-bio{
  font-size:14px;
  color:var(--muted);
}
.profile-extra{
  font-size:13px;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.upload-btn{
  margin-top:6px;
  font-size:12px;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  padding:6px 10px;
  border-radius:8px;
  color:#042231;
  cursor:pointer;
  width:fit-content;
  font-weight:600;
}
.upload-btn input{
  display:none;
}

  :root{
    --bg:#eaf6ff;
    --panel: rgba(255,255,255,0.6);
    --card: rgba(255,255,255,0.65);
    --glass-border: rgba(255,255,255,0.6);
    --text:#16324a;
    --muted:#5b728a;
    --accent:#8ab8ff;
    --accent-2:#9cd6ff;
    --accent-3:#bfe8ff;
    --success:#5aa882;
    --shadow: 0 10px 30px rgba(18,49,72,0.06);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--text)}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#f7fbff);-webkit-font-smoothing:antialiased}
  a{color:inherit}
  /* LANDING */
  .landing{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:28px;background:linear-gradient(180deg,#cfeeff,#f6fbff)}
  .hero{
    width:min(980px,96%);display:flex;gap:24px;align-items:center;padding:36px;border-radius:20px;
    background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.68));
    box-shadow:var(--shadow);backdrop-filter:blur(12px) saturate(140%);border:1px solid var(--glass-border)
  }
  .hero-left{flex:1}
  .logo{font-weight:800;font-size:28px;color:var(--accent-2);margin-bottom:6px}
  .subtitle{color:var(--muted);margin-bottom:18px;font-size:15px}
  .cta-row{display:flex;gap:12px;align-items:center}
  .btn-cta{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#042231;border:none;padding:12px 18px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 8px 28px rgba(138,185,255,0.22)}
  .btn-ghost{background:transparent;border:1px solid rgba(6,40,60,0.06);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
  .hero-right{width:260px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.58));backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.6)}
  .mini-clock{font-weight:700;font-size:20px;margin-bottom:8px;color:var(--text)}
  .mini-note{font-size:13px;color:var(--muted)}

  /* APP */
  .app{max-width:1200px;margin:32px auto;padding:20px;display:none;opacity:0;transform:translateY(8px);transition:all .45s}
  .app.visible{display:block;opacity:1;transform:none}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
  h1{font-size:22px;margin:0;color:var(--text);cursor:text}
  .small{font-size:13px;color:var(--muted)}
  .controls-top{display:flex;gap:10px;align-items:center}
  .card{
    background:var(--card);padding:14px;border-radius:12px;border:1px solid var(--glass-border);box-shadow:var(--shadow);
    backdrop-filter:blur(10px) saturate(130%);
  }
  .clock{padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.7),rgba(255,255,255,0.6))}
  .time{font-weight:700;color:var(--text)}
  .container{display:grid;grid-template-columns:1fr 380px;gap:16px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid rgba(10,30,50,0.04);font-size:14px;text-align:left}
  th{color:var(--muted);font-size:13px}
  .hour{width:70px;font-weight:700;color:var(--accent-2)}
  tr.current{background:linear-gradient(90deg, rgba(138,185,255,0.15), rgba(157,219,255,0.06));border-left:4px solid var(--accent)}
  tr.next{background:linear-gradient(90deg, rgba(157,219,255,0.06), transparent);border-left:4px solid var(--accent-2)}
  tr.done td{opacity:0.6;text-decoration:line-through;background:linear-gradient(90deg, rgba(90,168,130,0.06),transparent)}
  .actions{display:flex;gap:8px}
  .btn{background:transparent;border:1px solid rgba(6,40,60,0.06);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
  input[type="number"], input[type="text"], textarea{padding:8px;border-radius:8px;border:1px solid rgba(6,40,60,0.06);background:transparent;color:var(--text)}
  .side{display:flex;flex-direction:column;gap:12px}
  .box{padding:12px;border-radius:10px;background:var(--panel);border:1px solid var(--glass-border);backdrop-filter:blur(8px)}
  .upcoming{font-size:16px;font-weight:700}
  .drag-handle{cursor:grab;padding:6px;border-radius:6px;border:1px dashed rgba(6,40,60,0.04);margin-right:8px;color:var(--muted)}
  @media(max-width:920px){.container{grid-template-columns:1fr}.hero{flex-direction:column}.hero-right{width:100%}}

  /* DAYS UI */
  .days-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .day-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(6,40,60,0.06);background:transparent;cursor:pointer}
  .day-btn.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#042231;border:none}

  /* MODAL */
  .modal-overlay{position:fixed;inset:0;background:rgba(6,30,50,0.28);display:flex;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(3px);opacity:0;visibility:hidden;transition:opacity .2s, visibility .2s}
  .modal-overlay.show{opacity:1;visibility:visible}
  .modal{width:min(820px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.95));padding:18px;border-radius:12px;border:1px solid rgba(6,40,60,0.04);box-shadow:0 18px 60px rgba(10,30,50,0.08)}
  .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .modal-title{font-weight:700;color:var(--text)}
  .modal-content{max-height:60vh;overflow:auto;padding-right:8px}
  .modal textarea{width:100%;min-height:140px;padding:10px;border-radius:8px;border:1px solid rgba(6,40,60,0.06);resize:vertical}
  .chip{display:inline-block;padding:8px 10px;border-radius:10px;background:var(--accent-3);margin-right:8px;margin-bottom:8px;color:var(--text)}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#042231;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}

  .muted{color:var(--muted)}
</style>
</head>
<body>
  <!-- LANDING -->
  <div class="landing" id="landing" role="region" aria-label="landing screen">
    <div class="hero" role="region" aria-label="hero">
      <div class="hero-left">
        <div class="logo">Melly's Schedule</div>
        <!-- PROFILE CARD ON LANDING -->
<div class="profile-card">
  <img id="profilePhoto" src="https://via.placeholder.com/120" alt="Foto Profil">
  <div class="profile-info">
    <div contenteditable="true" class="profile-name" id="profileName">Nama Kamu</div>
    <div contenteditable="true" class="profile-bio" id="profileBio">Tambahkan bio singkat</div>

    <div class="profile-extra">
      <div>Email: <span contenteditable="true" id="profileEmail">email@example.com</span></div>
      <div>Instagram: <span contenteditable="true" id="profileIG">@username</span></div>
      <div>Mood Hari Ini: <span contenteditable="true" id="profileMood">üòä Happy</span></div>
    </div>

    <label class="upload-btn">
      Ganti Foto
      <input type="file" accept="image/*" id="uploadPhotoInput">
    </label>
  </div>
</div>

        <div class="subtitle">Rencana harian ‚Äî Have a nice day.</div>
        <div class="cta-row">
          <button class="btn-cta" id="enterBtn">Masuk</button>
          <button class="btn-ghost" id="skincareBtn">Skincare Routine</button>
        </div>
      </div>
      <div class="hero-right" aria-hidden="false">
        <div class="mini-clock" id="miniClock">00:00</div>
        <div class="mini-note">Hi!</div>
        <div style="height:12px"></div>
        <div class="muted">If u tired, rest. Then rise.</div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <main class="app" id="app" aria-live="polite">
    <div class="wrap">
      <header>
        <div>
          <h1 id="title" contenteditable="true" title="Klik untuk ubah judul">Melly's Schedule</h1>
          <div class="small" id="currentDayLabel">Hari: Senin</div>
        </div>

        <div class="controls-top">
          <div class="card clock" role="status">
            <div class="time" id="time">00:00:00</div>
            <div class="small" id="date">Senin, 1 Januari 2025</div>
          </div>
          <button id="themeBtn" class="btn" title="Toggle Light/Dark">üåó</button>
        </div>
      </header>

      <div class="container">
        <div class="card" role="region">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div style="display:flex;flex-direction:column">
              <div class="small">Jadwal (drag untuk pindah) ‚Äî Klik aksi untuk edit / hapus</div>
              <div class="days-row" id="daysRow" style="margin-top:8px"></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
              <div style="display:flex;gap:8px;">
                <button id="exportBtn" class="btn">Export CSV</button>
                <button id="resetBtn" class="btn">Reset Default</button>
              </div>
              <div class="muted" style="font-size:12px">Mode per-hari: klik "Mode ‚Üí [Produk/Kuliah/Libur]" untuk lihat hari yang pakai mode itu.</div>
            </div>
          </div>

          <table id="scheduleTable" aria-live="polite">
            <thead><tr><th></th><th class="hour">Jam</th><th>Kegiatan</th><th style="width:140px">Aksi</th></tr></thead>
            <tbody></tbody>
          </table>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <input type="number" id="addHour" min="0" max="23" placeholder="Jam (0-23)" />
            <input type="text" id="addText" placeholder="Deskripsi kegiatan" />
            <button id="addBtn" class="btn">Tambah</button>
          </div>
          <div class="small" style="margin-top:8px">just...me.</div>
        </div>

        <aside class="side" role="complementary">
          <button id="backToLanding" class="btn">‚üµ Kembali</button>

          <div class="box" aria-label="mode control">
            <div class="small">Mode (template)</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="modeProductive">üíº Produktif</button>
              <button class="btn" id="modeCollege">üìò Kuliah</button>
              <button class="btn" id="modeHoliday">üèñ Libur</button>
            </div>
            <div style="margin-top:10px;">
              <div class="small">Assign Mode to Days</div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <select id="assignModeSelect">
                  <option value="productive">üíº Produktif</option>
                  <option value="college">üìò Kuliah</option>
                  <option value="holiday">üèñ Libur</option>
                </select>
                <select id="assignDaySelect">
                  <option value="Senin">Senin</option><option value="Selasa">Selasa</option><option value="Rabu">Rabu</option>
                  <option value="Kamis">Kamis</option><option value="Jumat">Jumat</option><option value="Sabtu">Sabtu</option><option value="Minggu">Minggu</option>
                </select>
                <button id="assignBtn" class="btn">Assign</button>
              </div>
              <div class="small muted" style="margin-top:8px">Klik mode untuk lihat hari yang memakai mode tersebut.</div>
            </div>
          </div>

          <div class="box" aria-live="polite">
            <div class="small">Kegiatan Saat Ini</div>
            <div class="upcoming" id="currentTask">-</div>
            <div class="small" id="currentRange"></div>
          </div>

          <div class="box" aria-live="polite">
            <div class="small">Kegiatan Selanjutnya</div>
            <div class="upcoming" id="nextTask">-</div>
            <div class="small" id="nextRange"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="prevBtn" class="btn">‚üµ Sebelumnya</button>
              <button id="nextBtn" class="btn">Nanti ‚ü∂</button>
            </div>
          </div>

          <div class="box" aria-label="pomodoro">
            <div class="small">Timer</div>
            <div class="timer" id="pomTime">25:00</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="startPom" class="btn btn-primary">Start</button>
              <button id="pausePom" class="btn">Pause</button>
              <button id="resetPom" class="btn">Reset</button>
            </div>
            <div class="small" style="margin-top:8px">25 min work / 5 min break (default)</div>
          </div>

          <div class="box" style="display:flex;flex-direction:column;gap:8px">
            <div class="small">Fitur Tambahan (FocusKit)</div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn" id="openNotes">üóíÔ∏è DailyNote</button>
              <button class="btn" id="openWeekly">üéØ WeekWins</button>
              <button class="btn" id="openMood">üòä Moodly</button>
            </div>
          </div>
        </aside>
       <!-- SKINCARE PAGE -->
<section id="skincarePage" class="skincare-page" style="display:none; opacity:0; transform:translateY(8px); transition:all .28s;">
  <div class="card" style="margin:18px; padding:18px;">
    <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div>
        <h1 style="margin:0">Skincare Routine</h1>
        <div class="small">Edit rutinitas AM / PM ‚Äî perubahan otomatis disimpan</div>
      </div>
      <div class="controls-top">
        <button class="btn" id="backFromSkincare">‚üµ Kembali</button>
      </div>
    </header>

    <div class="container" style="grid-template-columns:1fr 1fr; gap:18px;">
      <!-- AM Routine -->
      <div class="card">
        <h3 style="margin-top:0;">AM Routine</h3>
        <div id="amList"></div>
        <div style="margin-top:12px; display:flex; gap:8px;">
            <input type="text" id="amInput" placeholder="Tambah step AM" />
            <button class="btn" id="addAmStep">Tambah</button>
        </div>
      </div>

      <!-- PM Routine -->
      <div class="card">
        <h3 style="margin-top:0;">PM Routine</h3>
        <div id="pmList"></div>
        <div style="margin-top:12px; display:flex; gap:8px;">
            <input type="text" id="pmInput" placeholder="Tambah step PM" />
            <button class="btn" id="addPmStep">Tambah</button>
        </div>
      </div>
    </div>
  </div>
</section>


  <!-- MODAL OVERLAY -->
  <div id="modalOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Modal</div>
        <div>
          <button id="closeModal" class="btn">Tutup</button>
        </div>
      </div>
      <div class="modal-content" id="modalContent"></div>
    </div>
  </div>

<script>
/* ----------------- Small helpers & constants ----------------- */
const DAYS = ['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'];
const MODE_TEMPLATES = {
  productive: [
    {h:5,text:'Bangun & stretching ‚Äî minum air, atur niat hari.',done:false},
    {h:6,text:'Journaling / planning ‚Äî tulis 3 tugas utama.',done:false},
    {h:7,text:'Sarapan & persiapan',done:false},
    {h:8,text:'Belajar Pemrograman ‚Äî HTML/CSS',done:false},
    {h:9,text:'Belajar Pemrograman ‚Äî Python basic',done:false},
    {h:10,text:'Break singkat + review',done:false},
    {h:11,text:'Project time ‚Äî praktek',done:false},
    {h:12,text:'Makan siang & istirahat',done:false},
    {h:13,text:'Latihan JS / DOM',done:false},
    {h:14,text:'Deep work ‚Äî coding challenge',done:false},
    {h:15,text:'Snack & istirahat mata',done:false},
    {h:16,text:'Tugas ringan / housework',done:false},
    {h:17,text:'Olahraga ringan',done:false},
    {h:18,text:'Mandi & santai',done:false},
    {h:19,text:'Makan malam',done:false},
    {h:20,text:'Project integration ‚Äî frontend/backend',done:false},
    {h:21,text:'Debugging & commit',done:false},
    {h:22,text:'Review & rencana besok',done:false},
    {h:23,text:'Tidur / prepare sleep',done:false}
  ],
  college: [
    {h:5,text:'Bangun + stretching',done:false},
    {h:6,text:'Sarapan + persiapan kuliah',done:false},
    {h:7,text:'Berangkat / siap kelas',done:false},
    {h:8,text:'Kuliah 1',done:false},
    {h:9,text:'Kuliah 2',done:false},
    {h:10,text:'Istirahat',done:false},
    {h:11,text:'Tugas / kelas tambahan',done:false},
    {h:12,text:'Makan siang',done:false},
    {h:13,text:'Tugas kampus',done:false},
    {h:14,text:'Review materi',done:false},
    {h:15,text:'Break',done:false},
    {h:16,text:'Organisasi / kegiatan kampus',done:false},
    {h:17,text:'Pulang / istirahat',done:false},
    {h:18,text:'Makan malam',done:false},
    {h:19,text:'Ngerjain tugas kuliah',done:false},
    {h:20,text:'Belajar ulang materi',done:false},
    {h:21,text:'Chill / skincare',done:false},
    {h:22,text:'Me time',done:false},
    {h:23,text:'Tidur',done:false}
  ],
  holiday: [
    {h:5,text:'Bangun santai',done:false},
    {h:6,text:'Jalan pagi / olahraga ringan',done:false},
    {h:7,text:'Sarapan',done:false},
    {h:8,text:'Bersih-bersih',done:false},
    {h:9,text:'Hobi (musik/game)',done:false},
    {h:10,text:'Chill time',done:false},
    {h:11,text:'Masak / aktivitas ringan',done:false},
    {h:12,text:'Makan siang',done:false},
    {h:13,text:'Nonton / series',done:false},
    {h:14,text:'Nap time',done:false},
    {h:15,text:'Me time',done:false},
    {h:16,text:'Jalan sore',done:false},
    {h:17,text:'Snack time',done:false},
    {h:18,text:'Makan malam',done:false},
    {h:19,text:'Santai / main HP',done:false},
    {h:20,text:'Hobi lagi',done:false},
    {h:21,text:'Skincare',done:false},
    {h:22,text:'Scroll + chill',done:false},
    {h:23,text:'Tidur',done:false}
  ]
};

const KEY_DAYMODE = 'jadwal_pastel_daymode_v2'; // mapping day -> mode
const KEY_DAY_PREFIX = 'jadwal_pastel_day_';   // full key: jadwal_pastel_day_Senin

/* ----------------- UI elements ----------------- */
const landing = document.getElementById('landing');
const enterBtn = document.getElementById('enterBtn');
const skincareBtn = document.getElementById('skincareBtn');
const app = document.getElementById('app');
const miniClock = document.getElementById('miniClock');
const daysRow = document.getElementById('daysRow');
const currentDayLabel = document.getElementById('currentDayLabel');

/* ----------------- App state ----------------- */
let currentDay = 'Senin'; // default open
let schedule = []; // current day's schedule loaded into table

/* ----------------- Landing behavior ----------------- */
enterBtn.addEventListener('click', ()=> openApp(true));

function openApp(showLandingGone = true){
  if(showLandingGone) landing.style.display = 'none';
  app.classList.add('visible');
  app.style.display = 'block';
  initializeApp();
}

function updateMiniClock(){
  const now = new Date();
  miniClock.textContent = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
}
setInterval(updateMiniClock,1000); updateMiniClock();

/* ----------------- Modal ----------------- */
const modalOverlay = document.getElementById('modalOverlay');
const modalTitle = document.getElementById('modalTitle');
const modalContent = document.getElementById('modalContent');
const closeModalBtn = document.getElementById('closeModal');
function openModal(title, html){ modalTitle.textContent = title; modalContent.innerHTML = html; modalOverlay.classList.add('show'); modalOverlay.setAttribute('aria-hidden','false'); }
function closeModal(){ modalOverlay.classList.remove('show'); modalOverlay.setAttribute('aria-hidden','true'); }
closeModalBtn.addEventListener('click', closeModal);
modalOverlay.addEventListener('click', (e)=>{ if(e.target===modalOverlay) closeModal(); });


/* ----------------- Day-mode mapping helpers ----------------- */
function getDayModeMap(){
  const raw = localStorage.getItem(KEY_DAYMODE);
  if(!raw){
    // default mapping: Senin-Jumat = college, Sabtu = productive, Minggu = holiday
    const def = {Senin:'college',Selasa:'college',Rabu:'college',Kamis:'college',Jumat:'college',Sabtu:'productive',Minggu:'holiday'};
    localStorage.setItem(KEY_DAYMODE, JSON.stringify(def));
    return def;
  }
  try{ return JSON.parse(raw); } catch(e){ return {}; }
}
function setDayMode(day, mode){
  const map = getDayModeMap();
  map[day] = mode;
  localStorage.setItem(KEY_DAYMODE, JSON.stringify(map));
}

/* ----------------- Per-day schedule storage ----------------- */
function dayStorageKey(day){ return KEY_DAY_PREFIX + day; }
function saveCurrentDaySchedule(){
  if(!currentDay) return;
  localStorage.setItem(dayStorageKey(currentDay), JSON.stringify(schedule));
}
function loadScheduleForDay(day){
  const raw = localStorage.getItem(dayStorageKey(day));
  if(raw){
    try{ schedule = JSON.parse(raw); }
    catch(e){ schedule = MODE_TEMPLATES[getDayModeMap()[day] || 'productive'].map(x=>({...x})); }
  } else {
    // if no saved schedule, use template from day mode
    const map = getDayModeMap();
    const mode = map[day] || 'productive';
    schedule = MODE_TEMPLATES[mode].map(x=>({...x}));
    // save implicitly so user sees it
    localStorage.setItem(dayStorageKey(day), JSON.stringify(schedule));
  }
}

/* ----------------- UI: Days row ----------------- */
function renderDaysRow(){
  daysRow.innerHTML = '';
  const map = getDayModeMap();
  DAYS.forEach(d => {
    const btn = document.createElement('button');
    btn.className = 'day-btn' + (d===currentDay ? ' active' : '');
    btn.textContent = d + ' ‚Ä¢ ' + (map[d] === 'college' ? 'üìò' : map[d] === 'productive' ? 'üíº' : 'üèñ');
    btn.addEventListener('click', ()=> {
      currentDay = d;
      currentDayLabel.textContent = 'Hari: ' + d;
      // reload schedule for that day
      loadScheduleForDay(currentDay);
      renderTable();
      renderDaysRow();
      updateClockAndHighlight();
    });
    daysRow.appendChild(btn);
  });
}

/* ----------------- Table render & interactivity ----------------- */
const tbody = document.querySelector('#scheduleTable tbody');
function renderTable(){
  tbody.innerHTML = '';
  schedule.forEach((item, idx) => {
    const tr = document.createElement('tr');
    tr.draggable = true;
    tr.dataset.index = idx;
    tr.dataset.hour = item.h;
    if(item.done) tr.classList.add('done');

    const tdDrag = document.createElement('td'); tdDrag.innerHTML = '<span class="drag-handle" aria-hidden="true">‚áÖ</span>';
    const tdHour = document.createElement('td'); tdHour.className = 'hour'; tdHour.textContent = String(item.h).padStart(2,'0')+':00';
    const tdText = document.createElement('td'); tdText.className = 'task'; tdText.textContent = item.text;
    const tdActions = document.createElement('td');
    tdActions.innerHTML = `<div class="actions">
      <button class="btn toggleDone">${item.done? '‚Ü∫ Undo' : '‚úîÔ∏è Selesai'}</button>
      <button class="btn edit">Edit</button>
      <button class="btn del">Hapus</button>
    </div>`;
    tr.appendChild(tdDrag); tr.appendChild(tdHour); tr.appendChild(tdText); tr.appendChild(tdActions);
    tbody.appendChild(tr);

    // events
    tdActions.querySelector('.toggleDone').addEventListener('click', ()=>{ schedule[idx].done = !schedule[idx].done; saveCurrentDaySchedule(); renderTable(); updateClockAndHighlight(); });
    tdActions.querySelector('.edit').addEventListener('click', ()=> {
      const newH = prompt('Ubah jam (0-23):', item.h); const nh = parseInt(newH);
      if(isNaN(nh)||nh<0||nh>23){ alert('Jam tidak valid'); return; }
      const newText = prompt('Ubah deskripsi:', item.text); if(newText===null) return;
      schedule[idx].h = nh; schedule[idx].text = newText; schedule.sort((a,b)=>a.h-b.h); saveCurrentDaySchedule(); renderTable(); updateClockAndHighlight();
    });
    tdActions.querySelector('.del').addEventListener('click', ()=>{ if(confirm('Hapus kegiatan ini?')){ schedule.splice(idx,1); saveCurrentDaySchedule(); renderTable(); updateClockAndHighlight(); } });

    // drag events: move entries in schedule array
    tr.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', idx); tr.style.opacity = 0.6; });
    tr.addEventListener('dragend', e => { tr.style.opacity = ''; });
    tr.addEventListener('dragover', e => { e.preventDefault(); tr.style.outline = '2px dashed rgba(6,40,60,0.06)'; });
    tr.addEventListener('dragleave', e => { tr.style.outline = ''; });
    tr.addEventListener('drop', e => {
      e.preventDefault(); tr.style.outline = '';
      const from = parseInt(e.dataTransfer.getData('text/plain'));
      const to = parseInt(tr.dataset.index);
      if(from === to) return;
      const it = schedule.splice(from,1)[0];
      schedule.splice(to,0,it);
      saveCurrentDaySchedule(); renderTable(); updateClockAndHighlight();
    });
  });
}

/* ----------------- Add / Export / Reset (per day) ----------------- */
document.getElementById('addBtn').addEventListener('click', ()=>{
  const h = parseInt(document.getElementById('addHour').value);
  const text = document.getElementById('addText').value.trim();
  if(isNaN(h)||h<0||h>23){ alert('Masukkan jam 0-23'); return; }
  if(!text){ alert('Masukkan deskripsi'); return; }
  schedule.push({h,text,done:false});
  schedule.sort((a,b)=>a.h-b.h);
  saveCurrentDaySchedule(); renderTable(); updateClockAndHighlight();
  document.getElementById('addHour').value=''; document.getElementById('addText').value='';
});
document.getElementById('exportBtn').addEventListener('click', ()=>{
  let csv = 'Jam,Deskripsi,Selesai, Hari\\n';
  DAYS.forEach(day => {
    const raw = localStorage.getItem(dayStorageKey(day));
    if(raw){
      try{
        const arr = JSON.parse(raw);
        arr.forEach(s=> csv += `${day},${String(s.h).padStart(2,'0')}:00,"${s.text.replace(/"/g,'""')}",${s.done? 'YES':'NO'}\\n`);
      }catch(e){}
    }
  });
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'jadwal_all_days.csv'; a.click(); URL.revokeObjectURL(a.href);
});
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(confirm('Reset semua hari ke template default? (Mode mapping tidak berubah)')){
    // reset each day's storage to its mode template
    const map = getDayModeMap();
    DAYS.forEach(day => {
      const mode = map[day] || 'productive';
      localStorage.setItem(dayStorageKey(day), JSON.stringify(MODE_TEMPLATES[mode].map(x=>({...x}))));
    });
    // reload current day
    loadScheduleForDay(currentDay); renderTable(); updateClockAndHighlight();
    alert('Semua hari direset sesuai mode masing-masing.');
  }
});

/* ----------------- Mode buttons: show days using the mode ----------------- */
document.getElementById('modeProductive').addEventListener('click', ()=> showModeDays('productive','üíº Produktif'));
document.getElementById('modeCollege').addEventListener('click', ()=> showModeDays('college','üìò Kuliah'));
document.getElementById('modeHoliday').addEventListener('click', ()=> showModeDays('holiday','üèñ Libur'));

function showModeDays(mode, title){
  const map = getDayModeMap();
  const days = DAYS.filter(d => (map[d]||'productive') === mode);
  let html = `<div class="small muted">Hari yang menggunakan mode <strong>${title}</strong>:</div><div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">`;
  days.forEach(d => html += `<button class="day-btn" data-day="${d}">${d}</button>`);
  html += `</div><div style="margin-top:12px" class="muted">Klik hari untuk buka jadwal hari itu. Kamu bisa ubah mode tiap hari di panel "Assign Mode to Days".</div>`;
  openModal(title, html);
  setTimeout(()=>{
    modalContent.querySelectorAll('[data-day]').forEach(b => b.addEventListener('click', (e)=>{
      const day = e.currentTarget.getAttribute('data-day');
      closeModal();
      currentDay = day;
      currentDayLabel.textContent = 'Hari: ' + day;
      loadScheduleForDay(day);
      renderTable();
      renderDaysRow();
      updateClockAndHighlight();
    }));
  },40);
}

/* ----------------- Assign mode to day control ----------------- */
document.getElementById('assignBtn').addEventListener('click', ()=>{
  const day = document.getElementById('assignDaySelect').value;
  const mode = document.getElementById('assignModeSelect').value;
  if(!day || !mode) return alert('Pilih hari & mode');
  setDayMode(day, mode);
  // initialize that day's schedule from template (but keep if user already has custom? We'll overwrite after confirm)
  if(confirm(`Assign mode ${mode} ke ${day}. Timpa jadwal hari ini dengan template mode? (OK = timpa, Cancel = simpan mode tanpa timpa)`)){
    localStorage.setItem(dayStorageKey(day), JSON.stringify(MODE_TEMPLATES[mode].map(x=>({...x}))));
  }
  renderDaysRow();
  alert(`${day} di-assign ke mode ${mode}`);
});

/* ----------------- Title edit & theme ----------------- */
const titleEl = document.getElementById('title');
const KEY_TITLE = 'jadwal_pastel_title_v2';
titleEl.addEventListener('blur', ()=> { localStorage.setItem(KEY_TITLE, titleEl.textContent.trim()); });
titleEl.addEventListener('keydown', (e)=> { if(e.key === 'Enter'){ e.preventDefault(); titleEl.blur(); } });

const themeBtn = document.getElementById('themeBtn');
const KEY_THEME = 'jadwal_pastel_theme_v2';
function applyTheme(t){
  if(t === 'light'){ document.documentElement.style.setProperty('--bg','#ffffff'); document.documentElement.style.setProperty('--card','rgba(255,255,255,0.95)'); localStorage.setItem(KEY_THEME,'light'); themeBtn.textContent='üåû'; }
  else { document.documentElement.style.setProperty('--bg','#eaf6ff'); document.documentElement.style.setProperty('--card','rgba(255,255,255,0.65)'); localStorage.setItem(KEY_THEME,'pastel'); themeBtn.textContent='üåó'; }
}
themeBtn.addEventListener('click', ()=> { const cur = localStorage.getItem(KEY_THEME) || 'pastel'; applyTheme(cur === 'pastel' ? 'light' : 'pastel'); });

/* ----------------- Pomodoro (simple) ----------------- */
let pomDuration = 25*60, breakDuration = 5*60, pomRemaining = pomDuration, pomInterval=null, pomRunning=false;
const pomTimeEl = document.getElementById('pomTime');
function fmt(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
function updatePom(){ pomTimeEl.textContent = fmt(pomRemaining); }
document.getElementById('startPom').addEventListener('click', ()=>{
  if(pomRunning) return;
  pomRunning=true;
  pomInterval=setInterval(()=>{ pomRemaining--; updatePom(); if(pomRemaining<=0){ clearInterval(pomInterval); pomRunning=false; if(Notification.permission==='granted') new Notification("Pomodoro","Sesi selesai!"); pomRemaining = breakDuration; updatePom(); } },1000);
});
document.getElementById('pausePom').addEventListener('click', ()=>{ if(pomInterval) clearInterval(pomInterval); pomRunning=false; pomInterval=null; });
document.getElementById('resetPom').addEventListener('click', ()=>{ if(pomInterval) clearInterval(pomInterval); pomRunning=false; pomRemaining=pomDuration; updatePom(); });
updatePom();

/* ----------------- DailyNote / WeekWins / Moodly (same as before) ----------------- */
const KEY_NOTES = 'jadwal_pastel_notes_v2';
const KEY_WEEKLY = 'jadwal_pastel_weekly_v2';
const KEY_MOOD = 'jadwal_pastel_mood_v2';
// DailyNote
document.getElementById('openNotes').addEventListener('click', ()=>{
  const notes = localStorage.getItem(KEY_NOTES) || '';
  const html = `
    <div style="display:flex;flex-direction:column;gap:10px">
      <div class="small muted">DailyNote ‚Äî tulis catatan harian. Tersimpan otomatis.</div>
      <textarea id="notesArea">${notes}</textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="saveNotes" class="btn-primary">Simpan</button>
        <button id="clearNotes" class="btn">Kosongkan</button>
      </div>
    </div>`;
  openModal('DailyNote', html);
  setTimeout(()=>{ document.getElementById('saveNotes').addEventListener('click', ()=>{ localStorage.setItem(KEY_NOTES, document.getElementById('notesArea').value); alert('Catatan tersimpan'); }); document.getElementById('clearNotes').addEventListener('click', ()=>{ if(confirm('Kosongkan catatan?')){ document.getElementById('notesArea').value=''; localStorage.removeItem(KEY_NOTES); } }); },50);
});
// WeekWins
document.getElementById('openWeekly').addEventListener('click', ()=>{
  const raw = localStorage.getItem(KEY_WEEKLY);
  const list = raw ? JSON.parse(raw) : ['Selesaikan modul HTML','Push 1 project ke GitHub','Kerjakan 3 latihan JS'];
  let itemsHtml = '';
  list.forEach((it,i)=> itemsHtml += `<div style="display:flex;gap:8px;align-items:center;margin-bottom:8px"><input type="text" data-i="${i}" value="${it}" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(6,40,60,0.06)"><button class="btn" data-del="${i}">Hapus</button></div>`);
  const html = `<div style="display:flex;flex-direction:column;gap:12px">
    <div class="small muted">WeekWins ‚Äî ubah langsung, lalu Simpan.</div>
    <div id="weeklyList">${itemsHtml}</div>
    <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
      <div><input id="newWeekly" type="text" placeholder="Tambah target baru" style="padding:8px;border-radius:8px;border:1px solid rgba(6,40,60,0.06)"></div>
      <div style="display:flex;gap:8px">
        <button id="addWeekly" class="btn">Tambah</button>
        <button id="saveWeekly" class="btn-primary">Simpan</button>
      </div>
    </div>
  </div>`;
  openModal('WeekWins', html);
  setTimeout(()=> {
    const wrapper = document.getElementById('weeklyList');
    wrapper.querySelectorAll('[data-del]').forEach(btn => btn.addEventListener('click', (e)=>{
      const idx = parseInt(e.currentTarget.getAttribute('data-del'));
      list.splice(idx,1); localStorage.setItem(KEY_WEEKLY, JSON.stringify(list)); closeModal(); document.getElementById('openWeekly').click();
    }));
    document.getElementById('addWeekly').addEventListener('click', ()=>{
      const v = document.getElementById('newWeekly').value.trim(); if(!v) return alert('Isi target dulu'); list.push(v); localStorage.setItem(KEY_WEEKLY, JSON.stringify(list)); closeModal(); document.getElementById('openWeekly').click();
    });
    document.getElementById('saveWeekly').addEventListener('click', ()=>{
      const inputs = wrapper.querySelectorAll('input[type="text"][data-i]'); const out=[]; inputs.forEach(inp => out.push(inp.value.trim())); localStorage.setItem(KEY_WEEKLY, JSON.stringify(out)); alert('Target disimpan'); closeModal();
    });
  },60);
});
// Moodly
document.getElementById('openMood').addEventListener('click', ()=>{
  const raw = localStorage.getItem(KEY_MOOD) || '';
  const html = `<div style="display:flex;flex-direction:column;gap:12px">
    <div class="small muted">Moodly ‚Äî pilih mood hari ini & catatan singkat.</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="chip" data-m="üòä">üòä Happy</button>
      <button class="chip" data-m="üôÇ">üôÇ Good</button>
      <button class="chip" data-m="üòê">üòê Okay</button>
      <button class="chip" data-m="üòî">üòî Sad</button>
      <button class="chip" data-m="üò´">üò´ Stressed</button>
    </div>
    <textarea id="moodNote" placeholder="Catatan singkat...">${raw}</textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button id="saveMood" class="btn-primary">Simpan</button>
    </div>
  </div>`;
  openModal('Moodly', html);
  setTimeout(()=>{
    document.querySelectorAll('.chip').forEach(c=> c.addEventListener('click',(e)=>{ document.getElementById('moodNote').value = `Mood: ${e.currentTarget.getAttribute('data-m')} ‚Äî `; }));
    document.getElementById('saveMood').addEventListener('click', ()=>{ localStorage.setItem(KEY_MOOD, document.getElementById('moodNote').value); alert('Mood tersimpan'); closeModal(); });
  },50);
});

/* ----------------- Clock & highlight & notifications ----------------- */
const timeEl = document.getElementById('time');
const dateEl = document.getElementById('date');
let lastNotifiedIdx = null;
function updateClockAndHighlight(){
  const now = new Date(); const h = now.getHours(); const m = now.getMinutes(); const s = now.getSeconds();
  timeEl.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  const localeDate = now.toLocaleDateString('id-ID', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
  dateEl.textContent = localeDate.charAt(0).toUpperCase() + localeDate.slice(1);

  document.querySelectorAll('#scheduleTable tbody tr').forEach(tr => { tr.classList.remove('current','next'); });

  const idx = schedule.findIndex(it => it.h === h);
  if(idx !== -1){
    setCurrent(idx, idx+1<=schedule.length-1?idx+1:null);
    if(s === 0) notifyIfNew(idx);
  } else {
    if(schedule.length===0){ setCurrent(null,null); return; }
    if(h < schedule[0].h) setCurrent(null, 0);
    else if(h > schedule[schedule.length-1].h) setCurrent(schedule.length-1, null);
    else {
      let prev = null;
      for(let i=0;i<schedule.length;i++) if(schedule[i].h < h) prev = i;
      if(prev !== null) setCurrent(prev, prev+1<=schedule.length-1?prev+1:null);
      else setCurrent(null,0);
    }
  }
}
function notifyIfNew(idx){
  if(idx === lastNotifiedIdx) return;
  lastNotifiedIdx = idx;
  if(Notification.permission === 'granted'){
    const text = schedule[idx].text;
    new Notification("Waktu sekarang", { body: text, silent:false });
  }
}
setInterval(updateClockAndHighlight, 1000);

function setCurrent(currentIdx, nextIdx){
  if(currentIdx !== null && currentIdx !== undefined){
    const curH = schedule[currentIdx].h;
    const tr = document.querySelector(`#scheduleTable tbody tr[data-hour='${curH}']`);
    if(tr) tr.classList.add('current');
    document.getElementById('currentTask').textContent = schedule[currentIdx].text;
    document.getElementById('currentRange').textContent = `${String(schedule[currentIdx].h).padStart(2,'0')}:00 - ${String((schedule[currentIdx].h+1)).padStart(2,'0')}:00`;
  } else { document.getElementById('currentTask').textContent = '-'; document.getElementById('currentRange').textContent = ''; }
  if(nextIdx !== null && nextIdx !== undefined){
    const nextH = schedule[nextIdx].h;
    const trn = document.querySelector(`#scheduleTable tbody tr[data-hour='${nextH}']`);
    if(trn) trn.classList.add('next');
    document.getElementById('nextTask').textContent = schedule[nextIdx].text;
    document.getElementById('nextRange').textContent = `${String(schedule[nextIdx].h).padStart(2,'0')}:00 - ${String((schedule[nextIdx].h+1)).padStart(2,'0')}:00`;
  } else { document.getElementById('nextTask').textContent = '-'; document.getElementById('nextRange').textContent = ''; }
}

/* ----------------- Day storage helpers (used earlier) ----------------- */
function dayStorageKey(day){ return KEY_DAY_PREFIX + day; }
function getDayModeMap(){
  const raw = localStorage.getItem(KEY_DAYMODE);
  if(!raw){
    const def = {Senin:'college',Selasa:'college',Rabu:'college',Kamis:'college',Jumat:'college',Sabtu:'productive',Minggu:'holiday'};
    localStorage.setItem(KEY_DAYMODE, JSON.stringify(def));
    return def;
  }
  try{ return JSON.parse(raw); } catch(e){ return {}; }
}
function setDayMode(day, mode){ const map = getDayModeMap(); map[day]=mode; localStorage.setItem(KEY_DAYMODE, JSON.stringify(map)); }

/* ----------------- Load app state & initial day ----------------- */
function initializeApp(){
  // load title
  const storedTitle = localStorage.getItem(KEY_TITLE); if(storedTitle) titleEl.textContent = storedTitle;

  // ensure day-mode map exists
  getDayModeMap();

  // current day: default to today's day name if possible
  const today = new Date();
  const todayName = DAYS[today.getDay()-1] || 'Senin';
  currentDay = todayName;

  // render days UI and load the day's schedule
  renderDaysRow();
  loadScheduleForDay(currentDay);
  renderTable();
  updateClockAndHighlight();

  // ensure daysRow is clickable done earlier
}

/* ----------------- Load schedule for day (and set currentDayLabel) ----------------- */
function loadScheduleForDay(day){
  currentDay = day;
  currentDayLabel.textContent = 'Hari: ' + day;
  const raw = localStorage.getItem(dayStorageKey(day));
  if(raw){
    try{ schedule = JSON.parse(raw); }
    catch(e){ schedule = MODE_TEMPLATES[getDayModeMap()[day] || 'productive'].map(x=>({...x})); localStorage.setItem(dayStorageKey(day), JSON.stringify(schedule)); }
  } else {
    const mode = getDayModeMap()[day] || 'productive';
    schedule = MODE_TEMPLATES[mode].map(x=>({...x}));
    localStorage.setItem(dayStorageKey(day), JSON.stringify(schedule));
  }
}

/* ----------------- Utilities: save current day ----------------- */
function saveCurrentDaySchedule(){ if(currentDay) localStorage.setItem(dayStorageKey(currentDay), JSON.stringify(schedule)); }

/* ----------------- Manual nav prev/next (per-day list) ----------------- */
document.getElementById('prevBtn').addEventListener('click', ()=>{
  let idx = schedule.findIndex(it => it.h === (new Date()).getHours());
  if(idx < 0) idx = 0;
  idx = Math.max(0, idx - 1);
  document.querySelectorAll('#scheduleTable tbody tr').forEach(tr=> tr.classList.remove('current','next'));
  const tr = document.querySelector(`#scheduleTable tbody tr[data-index='${idx}']`) || document.querySelector(`#scheduleTable tbody tr[data-hour='${schedule[idx].h}']`);
  if(tr) tr.classList.add('current');
  document.getElementById('currentTask').textContent = schedule[idx].text; document.getElementById('currentRange').textContent = `${String(schedule[idx].h).padStart(2,'0')}:00 - ${String(schedule[idx].h+1).padStart(2,'0')}:00`;
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  let idx = schedule.findIndex(it => it.h === (new Date()).getHours());
  if(idx < 0) idx = 0;
  idx = Math.min(schedule.length-1, idx + 1);
  document.querySelectorAll('#scheduleTable tbody tr').forEach(tr=> tr.classList.remove('current','next'));
  const tr = document.querySelector(`#scheduleTable tbody tr[data-index='${idx}']`) || document.querySelector(`#scheduleTable tbody tr[data-hour='${schedule[idx].h}']`);
  if(tr) tr.classList.add('current');
  document.getElementById('currentTask').textContent = schedule[idx].text; document.getElementById('currentRange').textContent = `${String(schedule[idx].h).padStart(2,'0')}:00 - ${String(schedule[idx].h+1).padStart(2,'0')}:00`;
});

/* ----------------- Ask Notification permission once when interact ----------------- */
function askNotif(){ if('Notification' in window && Notification.permission==='default'){ Notification.requestPermission(); } }
document.addEventListener('click', askNotif, {once:true});
/* ---------------- PROFILE SYSTEM ---------------- */

const photoEl = document.getElementById("profilePhoto");
const nameEl = document.getElementById("profileName");
const bioEl = document.getElementById("profileBio");
const emailEl = document.getElementById("profileEmail");
const igEl = document.getElementById("profileIG");
const moodEl = document.getElementById("profileMood");
const uploadInput = document.getElementById("uploadPhotoInput");

// load saved data
function loadProfile(){
  const saved = JSON.parse(localStorage.getItem("profileData") || "{}");
  if(saved.photo) photoEl.src = saved.photo;
  if(saved.name) nameEl.textContent = saved.name;
  if(saved.bio) bioEl.textContent = saved.bio;
  if(saved.email) emailEl.textContent = saved.email;
  if(saved.ig) igEl.textContent = saved.ig;
  if(saved.mood) moodEl.textContent = saved.mood;
}
loadProfile();

// save automatically when user edits text
function autoSaveProfile(){
  const data = {
    photo: photoEl.src,
    name: nameEl.textContent.trim(),
    bio: bioEl.textContent.trim(),
    email: emailEl.textContent.trim(),
    ig: igEl.textContent.trim(),
    mood: moodEl.textContent.trim(),
  };
  localStorage.setItem("profileData", JSON.stringify(data));
}

[nameEl, bioEl, emailEl, igEl, moodEl].forEach(el=>{
  el.addEventListener("input", autoSaveProfile);
});

// upload & save profile photo
uploadInput.addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    photoEl.src = e.target.result;
    autoSaveProfile();
  }
  reader.readAsDataURL(file);
});
/* ----------- TOMBOL KEMBALI KE LANDING ----------- */

document.getElementById("backToLanding").addEventListener("click", () => {
  document.getElementById("app").classList.remove("visible");
  document.getElementById("app").style.display = "none";
  document.getElementById("landing").style.display = "flex";
});
/* ===== SKINCARE PAGE LOGIC ===== */

const skincarePage = document.getElementById("skincarePage");
const backFromSkincare = document.getElementById("backFromSkincare");

// Routine arrays
let amRoutine = JSON.parse(localStorage.getItem("amRoutine") || `["Step 1","Step 2","Step 3"]`);
let pmRoutine = JSON.parse(localStorage.getItem("pmRoutine") || `["Step 1","Step 2","Step 3"]`);

function saveSkincare(){
    localStorage.setItem("amRoutine", JSON.stringify(amRoutine));
    localStorage.setItem("pmRoutine", JSON.stringify(pmRoutine));
}

function renderRoutine(list, containerId, type){
    const container = document.getElementById(containerId);
    container.innerHTML = "";

    list.forEach((step, index)=>{
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.gap = "8px";
        row.style.marginBottom = "8px";

        row.innerHTML = `
            <input type="text" value="${step}" data-edit="${index}" data-type="${type}" style="flex:1; padding:8px;">
            <button class="btn" data-del="${index}" data-type="${type}">Hapus</button>
        `;

        container.appendChild(row);
    });

    container.querySelectorAll('[data-edit]').forEach(input=>{
        input.addEventListener("input", ()=>{
            const i = input.dataset.edit;
            const t = input.dataset.type;
            if(t === "am") amRoutine[i] = input.value;
            else pmRoutine[i] = input.value;
            saveSkincare();
        });
    });

    container.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener("click", ()=>{
            const i = btn.dataset.del;
            const t = btn.dataset.type;
            if(t === "am") amRoutine.splice(i,1);
            else pmRoutine.splice(i,1);
            saveSkincare();
            loadSkincare();
        });
    });
}

function loadSkincare(){
    renderRoutine(amRoutine, "amList", "am");
    renderRoutine(pmRoutine, "pmList", "pm");
}

document.getElementById("addAmStep").addEventListener("click", ()=>{
    const v = document.getElementById("amInput").value.trim();
    if(!v) return;
    amRoutine.push(v);
    saveSkincare();
    loadSkincare();
    document.getElementById("amInput").value = "";
});
document.getElementById("addPmStep").addEventListener("click", ()=>{
    const v = document.getElementById("pmInput").value.trim();
    if(!v) return;
    pmRoutine.push(v);
    saveSkincare();
    loadSkincare();
    document.getElementById("pmInput").value = "";
});

/* OPEN & CLOSE SKINCARE PAGE - safer version */
const skincareBtnEl = document.getElementById("skincareBtn");
const skincarePageEl = document.getElementById("skincarePage");
const backFromSkincareEl = document.getElementById("backFromSkincare");

function showSkincarePage(){
  // hide landing & app
  landing.style.display = 'none';
  app.style.display = 'none';

  // show skincare page
  skincarePageEl.style.display = 'block';
  // allow repaint then fade in
  requestAnimationFrame(()=> {
    skincarePageEl.style.opacity = 1;
    skincarePageEl.style.transform = 'translateY(0)';
  });
  // render content
  try { loadSkincare(); }
  catch(e){ console.error('loadSkincare error', e); }
}

function hideSkincarePage(){
  skincarePageEl.style.opacity = 0;
  skincarePageEl.style.transform = 'translateY(8px)';
  setTimeout(()=>{
    skincarePageEl.style.display = 'none';
    // go back to landing (if you prefer opening app instead, replace accordingly)
    landing.style.display = 'flex';
  }, 260);
}

skincareBtnEl.addEventListener('click', showSkincarePage);
backFromSkincareEl.addEventListener('click', hideSkincarePage);

</script>
</body>
</html>
